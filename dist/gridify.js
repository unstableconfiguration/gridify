const e=function(e={}){let t=this;t.container=e.container,"string"==typeof t.container&&(t.container=document.getElementById(t.container)),t.create=function(e){t.container&&n(t.container),t.table.create(e),t.caption.create(e.caption),t.header.create(e.columns),t.body.create(e.data,e.columns),t.footer.create(e.columns),t.onTableCreated(i,e),t.container&&t.container.appendChild(i)},t.onTableCreated=function(e,t){t.onTableCreated&&t.onTableCreated(e,t)},t.onCaptionCreated=function(t,i){e.onCaptionCreated&&e.onCaptionCreated(t,i)},t.onHeaderCreated=function(t,i){e.onHeaderCreated&&e.onHeaderCreated(t,i)},t.onHeaderCellCreated=function(t,i){e.onHeaderCellCreated&&e.onHeaderCellCreated(t,i)},t.onTableBodyCreated=function(t,i){e.onTableBodyCreated&&e.onTableBodyCreated(t,i)},t.onTableRowCreated=function(t,i){e.onTableRowCreated&&e.onTableRowCreated(t,i)},t.onTableCellCreated=function(t,i){e.onTableCellCreated&&e.onTableCellCreated(t,i)},t.onFooterCreated=function(t,i){e.onFooterCreated&&e.onFooterCreated(t,i)},t.onFooterCellCreated=function(t,i){e.onFooterCellCreated&&e.onFooterCellCreated(t,i)};let i,n=function(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)},o=function(e,t){for(let i in t)e.setAttribute(i,t[i])};for(var r in t.table={create:function(e){i=t.table.initialize(e),o(i,e.attributes)},initialize:function(e){return i=document.createElement("table"),i.id=t.table._getTableId(e),i.options=t.table.__options(e),i},_getTableId:function(e){return i.id?i.id:e.id?e.id:t.container?t.container.id+"-grid":"new-grid"},__options:function(e){if(!e.columns&&(e.columns=[],Array.isArray(e.data)&&e.data.length>0))for(let t in e.data[0])e.columns.push({field:t});return e}},Object.defineProperty(t,"html",{get:()=>i}),t.caption={create:function(e){if(!e)return;let i=t.caption.initialize(),n=t.caption.__options(e);o(i,n.attributes),i.innerText=n.text,t.onCaptionCreated(i,n)},initialize:function(){let e=i.createCaption();return e.id=i.id+"-caption",e},__options:function(e){return"string"==typeof e?{text:e}:e}},t.header={create:function(e){if(!e)return;let i=t.header.initialize();t.header.addHeaderCells(e),t.onHeaderCreated(i,e)},initialize:function(){i.tHead&&i.removeChild(i.tHead);let e=i.createTHead();return e.id=i.id+"-thead",e},addHeaderCells:function(e){let n=i.tHead.insertRow();e.forEach((e=>{t.header.addHeaderCell(n,e)}))},addHeaderCell:function(e,n){let r=document.createElement("th");r.id=i.tHead.id+"-"+n.field||e.cells.length,e.appendChild(r);let l=t.header.__options(n);l&&(r.innerText=l.text,o(r,l.attributes)),t.onHeaderCellCreated(r,n)},__options:function(e){if(e.header)return"string"==typeof e.header?{text:e.header}:e.header}},t.body={initialize:function(){for(;i.tBodies.length;)i.removeChild(i.tBodies[0]);let e=i.createTBody();return e.id=i.id+"-tbody",e},clear:function(){n(i.tBodies[0])},create:function(e,i){let n=t.body.initialize();e&&e.forEach((e=>{t.body.addTableRow(n,e)})),t.onTableBodyCreated(n,i)},addTableRow:function(e,n){let o=e.insertRow();o.id=e.id+"-"+e.rows.length,i.options.columns.forEach((e=>{t.body.addTableCell(o,e,n[e.field])})),t.onTableRowCreated(o)},addTableCell:function(e,i,n){let r=e.insertCell();r.id=e.id+"-"+i.field,r.field=i.field,r.value=n,r.innerText=n,o(r,i.attributes),i.click&&(r.onclick=i.click),t.onTableCellCreated(r,i)}},t.data={get:function(){return Array.from(i.tBodies[0].rows).map((e=>t.data.getRowData(e)))},set:function(e){t.body.create(e)},getRowData:function(e){let t={};return Array.from(e.cells).forEach((e=>{t[e.field]=e.value})),t}},t.footer={create:function(e){if(!e)return;let i=t.footer.initialize(e);t.footer.addFooterCells(i,e),t.onFooterCreated(i,e)},initialize:function(){i.tFoot&&i.removeChild(i.tFoot);let e=i.createTFoot();return e.id=i.id+"-tfoot",e},addFooterCells:function(e,i){let n=e.insertRow();i.forEach((e=>{t.footer.addFooterCell(n,e)}))},addFooterCell:function(e,n){let r=e.insertCell();r.id=i.tFoot.id+"-"+n.field||e.cells.length;let l=t.footer.__options(n);l&&(r.innerText=l.text,o(r,l.attributes)),t.onFooterCellCreated(r,n)},__options:function(e){if(e.footer)return"string"==typeof e.footer?{text:e.footer}:e.footer}},t.extensions)t.extensions[r].apply(t,arguments);return t.create(e),t};e.prototype.extensions={filters:function(){let e=this;e.filter=function(){e.filters.filter()};let t=e.onHeaderCreated;e.onHeaderCreated=function(i,n){n.some((e=>e.filter))&&(e.filters.initialize(n),e.filters.addFilters(n)),t(i,n)},e.filters={initialize:function(t){let i=e.html.tHead.insertRow();i.id=e.html.id+"-filters",t.forEach((e=>{i.insertCell()}))},addFilters:function(t){let i=e.html.tHead.rows[1];t.forEach(((t,n)=>{let o=e.filters.addFilter(t);o&&i.cells[n].appendChild(o)}))},addFilter:function(t){if(!t.filter)return;let i=e.filters.__getFilterDefinition(t),n=i.control;return n.id=e.html.id+"-filters-"+t.field,n.compare=i.compare,n},cells:function(){return Array.from(e.html.tHead.rows[1].cells)},filter:function(){let t=e.filters.getControls();Array.from(e.html.tBodies[0].rows).forEach((e=>{let i=Array.from(e.cells),n=t.some((e=>{let t=i.find((t=>e.id.split("-").slice(-1)[0]==t.id.split("-").slice(-1)[0]));return!e.compare(t.value,e.value)}));e.filtered=n,e.style.display=n?"none":""}))},getControls:function(){return e.filters.cells().map((e=>e.firstChild)).filter((e=>!!e))},__getFilterDefinition:function(t){let i={control:e.filters.__getDefaultFilterControl(t),compare:e.filters.__getDefaultCompare()};if("function"==typeof t.filter&&(i.compare=t.filter),"object"==typeof t.filter)for(let e in t.filter)i[e]=t.filter[e];return i},__getDefaultCompare:function(){return function(e,t){return(""+e).toLowerCase().substr(0,t.length)==t.toLowerCase()}},__getDefaultFilterControl:function(t){let i=document.createElement("input");return i.type="text",i.style="display:block; margin: auto; width:80%;",i.addEventListener("change",(()=>{e.filters.filter()})),i}}},sorting:function(){let e=this;e.sort=function(t){e.sorting.sort(t)};let t=e.onHeaderCellCreated;e.onHeaderCellCreated=function(i,n){n.sort&&n.header&&e.sorting.initialize(i,n),t(i,n)},e.sorting={initialize:function(t,i){e.sorting.__addSortIcon(t),t.addEventListener("click",(t=>{let i=t.target.id.split("-").slice(-1)[0];e.sort(i)}))},sort:function(t){let i="string"==typeof t?t:t.field;if(!i)return;let n=e.sorting.__getSortOptions(i);t.direction?n.direction="asc"===t.direction.substr(0,3)?-1:1:n.direction=1===n.direction?-1:1;let o=t.compare||n.compare,r=Array.from(e.html.tBodies[0].rows),l=Array.from(r[0].cells).findIndex((e=>e.id.split("-").slice(-1)[0]==i));r.sort(((e,t)=>{let i=e.cells[l].value,r=t.cells[l].value;return+o(i,r)*n.direction})),e.sorting.__redrawGrid(r)},__getSortOptions:function(t){return e.html.sortOptions||e.sorting.__setSortOptions(),e.html.sortOptions[t]},__setSortOptions:function(){let t={};e.html.options.columns.forEach((i=>{t[i.field]=e.sorting.__options(i)})),e.html.sortOptions=t},__options:function(e){let t={compare:(e,t)=>e<=t?1:-1,direction:1};return"function"==typeof e.sort&&(t.compare=e.sort),e.sort&&e.sort.compare&&(t.compare=e.sort.compare),t},__addSortIcon:function(e){e.appendChild(document.createElement("span")).className="sort",e.style.paddingRight="30px"},__redrawGrid:function(t){e.body.clear();let i=e.html.tBodies[0];t.forEach((e=>i.appendChild(e)))}},Object.defineProperty(e.sorting,"defaultCompare",{get:()=>function(e,t){return e==t?0:e<t?1:-1}})},paging:function(){let e=this;e.page=function(...t){e.paging.page(...t)};let t=e.onTableCreated;e.onTableCreated=function(i,n){n.paging&&e.paging.initialize(n.paging),t(i,n)},e.footer.pager={initialize:function(t){let i=e.html.tFoot.insertRow();i.id=e.html.id+"-paging",i.options=t}},e.paging={initialize:function(t){if(!t)return;e.paging.extendSorting(),e.paging.extendFiltering();let i=e.paging._defaultOptions(t);e.paging.data=i,e.footer.pager.initialize(t),e.paging.page(i.currentPage)},extendSorting:function(){if(void 0!==e.sorting){let t=e.sorting.sort;e.sorting.sort=function(i={}){e.paging.clear(),t(i);let n=e.paging.data.currentPage;e.paging.page(n)}}},extendFiltering:function(){if(void 0!==e.filters){let t=e.filters.filter;e.filters.filter=function(){e.paging.clear(),t(),e.paging.page()}}},page:function(t=1){e.paging.data.currentPage=t,e.paging.data.visiblePages=e.paging._getVisiblePageCount(),e.paging._setRowVisibility(t)},clear:function(){Array.from(e.html.tBodies[0].rows).forEach((e=>{e.paged&&(e.paged=void 0,e.style.display="")}))},_getVisiblePageCount:function(){let t=Array.from(e.html.tBodies[0].rows);return t=t.filter((e=>!e.filtered)),Math.ceil(t.length/e.paging.data.rows)},_setRowVisibility:function(t){let i=Array.from(e.html.tBodies[0].rows),n=e.paging.data;e.paging.clear();let o=(n.currentPage-1)*n.rows,r=n.currentPage*n.rows;i=i.filter((e=>"none"!==e.style.display)),i=i.filter(((e,t)=>t>=r||t<o)),i.forEach((e=>{e.style.display="none",e.paged=!0}))},_defaultOptions:function(t){return"object"!=typeof t&&(t={}),t.rows=t.rows||20,t.totalRows=t.totalRows||e.data.get().length,t.totalPages=Math.ceil(t.totalRows/t.rows),t.visiblePages=t.totalPages,t.currentPage=t.currentPage||1,t}}},styling:function(){let e=this,t=e.onTableCreated;e.onTableCreated=function(i,n){e.styling.stylize(i,n),t(i,n)};let i=e.onCaptionCreated;e.onCaptionCreated=function(t,n){e.styling.stylize(t,n),i(t,n)};let n=e.onHeaderCellCreated;e.onHeaderCellCreated=function(t,i){let o=(i.style||"").split(";").find((e=>e.includes("width")));e.styling.stylize(t,{style:o}),e.styling.stylize(t,i.header),n(t,i)};let o=e.onTableCellCreated;e.onTableCellCreated=function(t,i){e.styling.stylize(t,i),o(t,i)};let r=e.onFooterCellCreated;e.onFooterCellCreated=function(t,i){e.styling.stylize(t,i.footer),r(t,i)},e.styling={stylize:function(t,i){i&&(i.className&&(t.className=i.className),i.style&&e.styling.setStyle(t,i.style))},setStyle:function(e,t){(t||"").split(";").map((e=>e.trim().split(":"))).forEach((t=>{if(!t||2!==t.length)return;let i=t[0].trim(),n=t[1].trim();e.style[i]=n}))}}}};export{e as Gridify};
