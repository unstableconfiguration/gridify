const e=function(e={}){let t=this;t.container=e.container,"string"==typeof t.container&&(t.container=document.getElementById(t.container)),t.create=function(e){t.container&&i(t.container),t.table.create(e),t.caption.create(e.caption),t.header.create(e.columns),t.body.create(e.data,e.columns),t.footer.create(e.columns),t.onTableCreated(n,e),t.container&&t.container.appendChild(n)},t.onTableCreated=function(e,t){t.onTableCreated&&t.onTableCreated(e,t)},t.onCaptionCreated=function(t,n){e.onCaptionCreated&&e.onCaptionCreated(t,n)},t.onHeaderCreated=function(t,n){e.onHeaderCreated&&e.onHeaderCreated(t,n)},t.onHeaderCellCreated=function(t,n){e.onHeaderCellCreated&&e.onHeaderCellCreated(t,n)},t.onTableBodyCreated=function(t,n){e.onTableBodyCreated&&e.onTableBodyCreated(t,n)},t.onTableRowCreated=function(t,n){e.onTableRowCreated&&e.onTableRowCreated(t,n)},t.onTableCellCreated=function(t,n){e.onTableCellCreated&&e.onTableCellCreated(t,n)},t.onFooterCreated=function(t,n){e.onFooterCreated&&e.onFooterCreated(t,n)},t.onFooterCellCreated=function(t,n){e.onFooterCellCreated&&e.onFooterCellCreated(t,n)};let n,i=function(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)},o=function(e,t){for(let n in t)e.setAttribute(n,t[n])};for(var r in t.table={create:function(e){n=t.table.initialize(e),o(n,e.attributes)},initialize:function(e){return n=document.createElement("table"),n.id=t.table._getTableId(e),n.options=t.table.__options(e),n},_getTableId:function(e){return n.id?n.id:e.id?e.id:t.container?t.container.id+"-grid":"new-grid"},__options:function(e){if(!e.columns&&(e.columns=[],Array.isArray(e.data)&&e.data.length>0))for(let t in e.data[0])e.columns.push({field:t});return e}},Object.defineProperty(t,"html",{get:()=>n}),t.caption={create:function(e){if(!e)return;let n=t.caption.initialize(),i=t.caption.__options(e);o(n,i.attributes),n.innerText=i.text,t.onCaptionCreated(n,i)},initialize:function(){let e=n.createCaption();return e.id=n.id+"-caption",e},__options:function(e){return"string"==typeof e?{text:e}:e}},t.header={create:function(e){if(!e)return;let n=t.header.initialize();t.header.addHeaderCells(e),t.onHeaderCreated(n,e)},initialize:function(){n.tHead&&n.removeChild(n.tHead);let e=n.createTHead();return e.id=n.id+"-thead",e},addHeaderCells:function(e){let i=n.tHead.insertRow();e.forEach((e=>{t.header.addHeaderCell(i,e)}))},addHeaderCell:function(e,i){let r=document.createElement("th");r.id=n.tHead.id+"-"+i.field||e.cells.length,e.appendChild(r);let l=t.header.__options(i);l&&(r.innerText=l.text,o(r,l.attributes)),t.onHeaderCellCreated(r,i)},__options:function(e){if(e.header)return"string"==typeof e.header?{text:e.header}:e.header}},t.body={initialize:function(){for(;n.tBodies.length;)n.removeChild(n.tBodies[0]);let e=n.createTBody();return e.id=n.id+"-tbody",e},clear:function(){i(n.tBodies[0])},create:function(e,n){let i=t.body.initialize();e&&e.forEach((e=>{t.body.addTableRow(i,e)})),t.onTableBodyCreated(i,n)},addTableRow:function(e,i){let o=e.insertRow();o.id=e.id+"-"+e.rows.length,n.options.columns.forEach((e=>{t.body.addTableCell(o,e,i[e.field])})),t.onTableRowCreated(o)},addTableCell:function(e,n,i){let r=e.insertCell();r.id=e.id+"-"+n.field,r.field=n.field,r.value=i,r.innerText=i,o(r,n.attributes),n.click&&(r.onclick=n.click),t.onTableCellCreated(r,n)}},t.data={get:function(){return Array.from(n.tBodies[0].rows).map((e=>t.data.getRowData(e)))},set:function(e){t.body.create(e)},getRowData:function(e){let t={};return Array.from(e.cells).forEach((e=>{t[e.field]=e.value})),t}},t.footer={create:function(e){if(!e)return;let n=t.footer.initialize(e);t.footer.addFooterCells(n,e),t.onFooterCreated(n,e)},initialize:function(){n.tFoot&&n.removeChild(n.tFoot);let e=n.createTFoot();return e.id=n.id+"-tfoot",e},addFooterCells:function(e,n){let i=e.insertRow();n.forEach((e=>{t.footer.addFooterCell(i,e)}))},addFooterCell:function(e,i){let r=e.insertCell();r.id=n.tFoot.id+"-"+i.field||e.cells.length;let l=t.footer.__options(i);l&&(r.innerText=l.text,o(r,l.attributes)),t.onFooterCellCreated(r,i)},__options:function(e){if(e.footer)return"string"==typeof e.footer?{text:e.footer}:e.footer}},t.extensions)t.extensions[r].apply(t,arguments);return t.create(e),t};e.prototype.extensions={filters:function(){let e=this;e.filter=function(){e.filters.filter()};let t=e.onHeaderCreated;e.onHeaderCreated=function(n,i){i.some((e=>e.filter))&&(e.filters.initialize(i),e.filters.addFilters(i)),t(n,i)},e.filters={initialize:function(t){let n=e.html.tHead.insertRow();n.id=e.html.id+"-filters",t.forEach((e=>{n.insertCell()}))},addFilters:function(t){let n=e.html.tHead.rows[1];t.forEach(((t,i)=>{let o=e.filters.addFilter(t);n.cells[i].appendChild(o)}))},addFilter:function(t){if(!t.filter)return;let n=e.filters.__getFilterDefinition(t),i=n.control;return i.id=e.html.id+"-filters-"+t.field,i.compare=n.compare,i},cells:function(){return Array.from(e.html.tHead.rows[1].cells)},filter:function(){let t=e.filters.getControls();Array.from(e.html.tBodies[0].rows).forEach((e=>{let n=Array.from(e.cells),i=t.some((e=>{let t=n.find((t=>e.id.split("-").slice(-1)[0]==t.id.split("-").slice(-1)[0]));return!e.compare(t.value,e.value)}));e.filtered=i,e.style.display=i?"none":""}))},getControls:function(){return e.filters.cells().map((e=>e.firstChild)).filter((e=>!!e))},__getFilterDefinition:function(t){let n={control:e.filters.__getDefaultFilterControl(t),compare:e.filters.__getDefaultCompare()};if("function"==typeof t.filter&&(n.compare=t.filter),"object"==typeof t.filter)for(let e in t.filter)n[e]=t.filter[e];return n},__getDefaultCompare:function(){return function(e,t){return(""+e).toLowerCase().substr(0,t.length)==t.toLowerCase()}},__getDefaultFilterControl:function(t){let n=document.createElement("input");return n.type="text",n.style="display:block; margin: auto; width:80%;",n.addEventListener("change",(()=>{e.filters.filter()})),n}}},sorting:function(){let e=this;e.sort=function(t){e.sorting.sort(t)};let t=e.onHeaderCellCreated;e.onHeaderCellCreated=function(n,i){i.sort&&i.header&&e.sorting.initialize(n,i),t(n,i)},e.sorting={initialize:function(t,n){e.sorting.__addSortIcon(t),t.addEventListener("click",(t=>{let n=t.id.split("-").slice(-1)[0];e.sort(n)}))},sort:function(t){let n="string"==typeof t?t:t.field;if(!n)return;let i=e.sorting.__getSortOptions(n);t.direction?i.direction="asc"===t.direction.substr(0,3)?-1:1:i.direction=1===i.direction?-1:1;let o=t.compare||i.compare,r=Array.from(e.html.tBodies[0].rows),l=Array.from(r[0].cells).findIndex((e=>e.id.split("-").slice(-1)[0]==n));r.sort(((e,t)=>{let n=e.cells[l].value,r=t.cells[l].value;return+o(n,r)*i.direction})),e.sorting.__redrawGrid(r)},__getSortOptions:function(t){return e.html.sortOptions||e.sorting.__setSortOptions(),e.html.sortOptions[t]},__setSortOptions:function(){let t={};e.html.options.columns.forEach((n=>{t[n.field]=e.sorting.__options(n)})),e.html.sortOptions=t},__options:function(e){let t={compare:(e,t)=>e<=t?1:-1,direction:1};return"function"==typeof e.sort&&(t.compare=e.sort),e.sort&&e.sort.compare&&(t.compare=e.sort.compare),t},__addSortIcon:function(e){e.appendChild(document.createElement("span")).className="sort",e.style.paddingRight="30px"},__redrawGrid:function(t){e.body.clear();let n=e.html.tBodies[0];t.forEach((e=>n.appendChild(e)))}},Object.defineProperty(e.sorting,"defaultCompare",{get:()=>function(e,t){return e==t?0:e<t?1:-1}})},paging:function(){let e=this,t=e.onTableCreated;e.onTableCreated=function(n,i){i.paging&&e.paging.initialize(i.paging),t(n,i)},e.footer.pager={initialize:function(t){let n=e.html.tFoot.insertRow();n.id=e.html.id+"-paging",n.options=t;let i=n.insertCell();i.id=e.html.id+"-paging-left",i.style="width:33%;";let o=n.insertCell();o.id=e.html.id+"-paging-center",o.style="width:33%;",o.appendChild(e.footer.pager.pagingControl(t));let r=n.insertCell();r.id=e.html.id+"-paging-right",r.style="width:33%;"},setPage:function(t){let n=document.getElementById(e.html.id+"-paging-center-textbox");n&&(n.value=t)},pagingControl:function(t){let n=document.createElement("div");n.style="width:120px";let i=document.createElement("input");i.id=e.html.id+"-paging-center-textbox",i.className="pager-textbox",i.value=t.currentPage||1,i.addEventListener("change",(()=>{e.paging.page(i.value<t.totalPages?+i.value:t.totalPages)}));let o=document.createElement("span");o.style="width:40px;vertical-align:top",o.innerText=" of "+t.totalPages||1;let r=document.createElement("div");r.className="pager-left",r.onclick=()=>e.paging.page(i.value>1?+i.value-1:1);let l=document.createElement("div");return l.className="pager-right",l.onclick=()=>e.paging.page(i.value<t.totalPages?+i.value+1:t.totalPages),n.appendChild(r),n.appendChild(i),n.appendChild(o),n.appendChild(l),n}},e.paging={initialize:function(t){t&&(e.paging.extendSorting(),e.paging.extendFiltering(),t=e.paging._defaultOptions(t),e.html.options.paging=t,e.footer.pager.initialize(t),e.paging.page(t.currentPage))},extendSorting:function(){if(void 0!==e.sorting){let t=e.sorting.sort;e.sorting.sort=function(n={}){e.paging.clear(),t(n);let i=e.html.options.paging.currentPage;e.paging.page(i)}}},extendFiltering:function(){if(void 0!==e.filters){let t=e.filters.filter;e.filters.filter=function(){e.paging.clear(),t(),e.paging.page()}}},page:function(t=1){e.html.options.paging.currentPage=t,e.paging._setFooterValues(t),e.paging._setRowVisibility(t)},clear:function(){Array.from(e.html.tBodies[0].rows).forEach((e=>{e.paged&&(e.paged=void 0,e.style.display="")}))},_setRowVisibility:function(t){let n=Array.from(e.html.tBodies[0].rows),i=e.html.options.paging;e.paging.clear();let o=(i.currentPage-1)*i.rows,r=i.currentPage*i.rows;n=n.filter((e=>"none"!==e.style.display)),n=n.filter(((e,t)=>t>=r||t<o)),n.forEach((e=>{e.style.display="none",e.paged=!0}))},_setFooterValues:function(t){e.footer.pager.setPage(t)},_defaultOptions:function(t){return"object"!=typeof t&&(t={}),t.rows=t.rows||20,t.totalRows=t.totalRows||e.data.get().length,t.totalPages=Math.ceil(t.totalRows/t.rows),t.currentPage=t.currentPage||1,t}}},styling:function(){let e=this,t=e.onTableCreated;e.onTableCreated=function(n,i){e.styling.stylize(n,i),t(n,i)};let n=e.onCaptionCreated;e.onCaptionCreated=function(t,i){e.styling.stylize(t,i),n(t,i)};let i=e.onHeaderCellCreated;e.onHeaderCellCreated=function(t,n){n.style&&e.styling.setStyle(t,n.style),e.styling.stylize(t,n.header),i(t,n)};let o=e.onTableCellCreated;e.onTableCellCreated=function(t,n){e.styling.stylize(t,n),o(t,n)};let r=e.onFooterCellCreated;e.onFooterCellCreated=function(t,n){e.styling.stylize(t,n.footer),r(t,n)},e.styling={stylize:function(t,n){n&&(n.className&&(t.className=n.className),n.style&&e.styling.setStyle(t,n.style))},setStyle:function(e,t){(t||"").split(";").map((e=>e.trim().split(":"))).forEach((t=>{if(!t||2!==t.length)return;let n=t[0].trim(),i=t[1].trim();e.style[n]=i}))}}}};export{e as Gridify};
